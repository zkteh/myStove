<!DOCTYPE html>
	<html lang="en">
	<head>
	    <meta charset="UTF-8">
	    <title>Creating Real-Time Charts with Flask</title>
	    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
	    <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css" rel="stylesheet">
	</head>
	<body>
	<div class="container">
	    <div class="row">
	        <div class="col-12">
	            <div class="card">
	                <div class="card-body">
	                    <canvas id="canvas"></canvas>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	
	<p>ds18b20: <span id="timestamp"></span></p>
	<p>ds18b20: <span id="ds18b20"></span></p>
	<p>mlx_ambient: <span id="mlx_ambient"></span></p>
	<p>mlx_object: <span id="mlx_object"></span></p>
	<p>mlx_object_avg_over1min: <span id="mlx_object_avg"></span></p>
	
	<!--suppress JSUnresolvedLibraryURL -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<!--suppress JSUnresolvedLibraryURL -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<!--suppress JSUnresolvedLibraryURL -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
		
	<script>
	    $(document).ready(function () {	        	        	     
	        const config = {
	            type: 'line',
	            data: {
	                labels: [],
	                datasets: [{
	                    label: "ds18b20",
	                    backgroundColor: 'rgb(255, 99, 132)',
	                    borderColor: 'rgb(255, 99, 132)',
	                    data: [],
	                    fill: false,
	                }, {
	                    label: "mlx_ambient",
	                    backgroundColor: 'rgb(97, 171, 64)',
	                    borderColor: 'rgb(97, 171, 64)',
	                    data: [],
	                    fill: false,
	                }, {
	                    label: "mlx_object",
	                    backgroundColor: 'rgb(0, 168, 255)',
	                    borderColor: 'rgb(0, 168, 255)',
	                    data: [],
	                    fill: false,
					},{
	                    label: "mlx_object_avg",
	                    backgroundColor: 'rgb(159, 51, 255)',
	                    borderColor: 'rgb(159, 51, 255)',
	                    data: [],
	                    fill: false,
	                }],
	            },
	            options: {
	                responsive: true,
	                title: {
	                    display: true,
	                    text: 'Creating Real-Time Charts with Flask'
	                },
	                tooltips: {
	                    mode: 'index',
	                    intersect: false,
	                },
	                hover: {
	                    mode: 'nearest',
	                    intersect: true
	                },
	                scales: {
	                    xAxes: [{
	                        display: true,
	                        scaleLabel: {
	                            display: true,
	                            labelString: 'Time'
	                        }
	                    }],
	                    yAxes: [{
	                        display: true,
	                        scaleLabel: {
	                            display: true,
	                            labelString: 'Value'
	                        }
	                    }]
	                }
	            }
	        };
	            
	        const context = document.getElementById('canvas').getContext('2d');
	        const lineChart = new Chart(context, config);
	
	                            
	        //var jsonurl = "/data";
	        function fetchdata(){
	            $.getJSON('/data', function (data) {   
					
					//declare var for easy usage
					var timestamp = data.c[0][0];
					var ds18b20 = data.c[0][1];
					var mlx_ambient = data.c[0][2];
					var mlx_object = data.c[0][3];
					var mlx_object_avg = data.d[0][0];
			
	              // for (var i=0; i < data.length; i++){                
	                //shift the old data to make the graph nicer
	                if (config.data.labels.length === 60) {    
	                    config.data.labels.shift();
	                    config.data.datasets[0].data.shift();
	                    config.data.datasets[1].data.shift();
						config.data.datasets[2].data.shift();
						config.data.datasets[3].data.shift();
					}
					
	                //insert data to graph   
	                config.data.labels.push(timestamp); 
	                config.data.datasets[0].data.push(ds18b20); 
	                config.data.datasets[1].data.push(mlx_ambient); 
					config.data.datasets[2].data.push(mlx_object); 
					config.data.datasets[3].data.push(mlx_object_avg); 
	                lineChart.update();
	
					//update current value on web
					document.getElementById("timestamp").textContent = timestamp;  
	                document.getElementById("ds18b20").textContent = ds18b20;
	                document.getElementById("mlx_ambient").textContent = mlx_ambient;
					document.getElementById("mlx_object").textContent = mlx_object; 
					document.getElementById("mlx_object_avg").textContent = mlx_object_avg;

	               //}//end of for loop()                               
	            }); //end of $.getJSON()
	         }//end of fetchdata()
			
			 //loop to get new data
	        $(document).ready(function(){
	           setInterval(fetchdata,1000);
	        });    
	                       
	    }); //end of $(document).ready(funct)
	    
	</script>
	</body>
	</html>
